function queryParams(params){var ids=$("#ingredients-selector").val().join(",");return params.altnameids=ids,params}function ingredientsFormatter(value,row,index){return'<span class="js-ingredients-entry" data-ucd="'+value.ucd+'" data-cid="'+value.cid+'">'+value.ingredients+"</span>"}function likeFormatter(value,row,index){return'<button type="button" class="table-btn like-btn" data-btn-on="'+value.like+'" aria-label="Like"><span class="glyphicon glyphicon-thumbs-up table-icon" aria-hidden="true"></span></button><button type="button" class="table-btn dislike-btn" data-btn-on="'+value.dislike+'" aria-label="Dislike"><span class="glyphicon glyphicon-thumbs-down table-icon" aria-hidden="true"></span></button>'}function favoriteFormatter(value,row,index){return'<button type="button" class="table-btn favorite-btn" data-btn-on="'+value+'" aria-label="Star"><span class="glyphicon glyphicon-star table-icon" aria-hidden="true"></span></button>'}function update_ucd(event,target,note=""){var which_changed=get_which_changed(target),$table=$("#combos-table"),$row=target.closest("tr"),$ingredients=$row.find(".js-ingredients-entry");$.ajax({url:$table.data("ajax-url"),type:"POST",data:JSON.stringify({ucd_id:$ingredients.attr("data-ucd"),combo_id:$ingredients.attr("data-cid"),which_changed:which_changed,note:note}),context:$row,success:function(data){this.find(".like-btn").attr("data-btn-on",data.like),this.find(".dislike-btn").attr("data-btn-on",data.dislike),this.find(".favorite-btn").attr("data-btn-on",data.favorite),this.find(".js-ingredients-entry").attr("data-ucd",data.ucd_id);var $note=this.find("a");$note.hasClass("editable-unsaved")&&$note.removeClass("editable-unsaved")},error:function(xhr,status,error){console.log("Status: "+status),console.log("Error: "+error),console.dir(xhr)}})}function get_which_changed(target){return target.hasClass("like-btn")?"like":target.hasClass("dislike-btn")?"dislike":target.hasClass("favorite-btn")?"favorite":target.hasClass("editable")?"note":void 0}$(document).ready(function(){function csrfSafeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}$("#ingredients-selector").select2({ajax:{url:$("#ingredients-selector").data("ajax-select2"),dataType:"json",delay:250,data:function(params){return{q:params.term,page:params.page}}},minimumInputLength:1,placeholder:"Select ingredients..."}),$("#ingredients-selector").on("change",function(e){$("#combos-table").bootstrapTable("selectPage",1)}),$("#combos-table").on("sort.bs.table",function(e,name,order){$("#combos-table").bootstrapTable("selectPage",1)}),$("#combos-table").on("click",".table-btn",function(event){event.preventDefault(),update_ucd(event,$(this))}),$("#combos-table").on("editable-save.bs.table",function(editable,field,row,oldValue,$el){update_ucd(editable,$el,row.notes)});var csrftoken=function(name){var cookieValue=null;if(document.cookie&&""!==document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue}("csrftoken");$.ajaxSetup({beforeSend:function(xhr,settings){csrfSafeMethod(settings.type)||this.crossDomain||xhr.setRequestHeader("X-CSRFToken",csrftoken)}})});
