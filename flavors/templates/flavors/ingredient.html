{% extends "base.html" %}
{% load staticfiles %}

{% load bootstrap3 %}

{% block head_title %}{{ listing.listed_name|lower|capfirst }}{% endblock %}

{% block head_css %}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
  <link rel="stylesheet" href="{% static 'flavors/css/allauth.css' %}">
  <link rel="stylesheet" href="{% static 'css/custom.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h1>{{ listing.listed_name|lower|capfirst }}</h1>

  {% if altName.name != listing.listed_name %}
    <h5>Redirected from {{ altName.name|capfirst }}</h5>
  {% endif %}

  {% if listing.umbrella_cat %}
    <h4>See also: <a href="{% url 'flavors:pairings' listing.umbrella_cat %}">{{ listing.umbrella_cat|capfirst }}</a> </h4>
  {% endif %}

  <ul>
      {% for taste in listing.tastes.all %}
        <li>{{ taste.mouth_taste }}</li>
      {% endfor %}
  </ul>

{% if user.is_authenticated %}
  <div class="table-responsive">
    <table id="combos-table" class="table table-striped table-hover"
      data-toggle="table" data-search="true" data-show-columns="true"
      data-pagination="true" data-side-pagination="server"
      data-page-list="[2, 4, 8]" data-url="{% url 'flavors:pairings' altName.name %}"> <!-- .table-condensed ?-->
      <thead>
        <tr>
            <th data-field="ingredients" data-sortable="true" data-sort-name="_ingredients_data" data-sorter="numIngsSorter">Ingredients</th>
            <th data-field="ratings" data-sortable="true">Ratings</th>
            <th data-field="pctliked" data-sortable="true">% Liked</th>
            <th data-field="like">Like</th>
            <th data-field="star" data-sortable="true">Star</th>
            <th data-field="notes" data-editable="true" data-editable-type="textarea" data-editable-mode="inline">Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for ings, combo, userComboData in data_row %}
          <tr data-ucd="{{ userComboData.id }}" data-cid="{{ combo.id }}" data-ajax-url="{% url 'ajax_update' %}">
            <td data-numings='{{ ings.count }}'>
              {% for ing in ings %}
                {{ ing }}
              {% endfor %}
            </td>
            <td>{{combo.get_num_tried}}</td>
            <td>{{combo.calc_percent_likes}}</td>
            <td>
              <button type="button" class="table-btn like-btn" data-btn-on="{{ userComboData.like }}" aria-label="Like">
                <span class="glyphicon glyphicon-thumbs-up table-icon" aria-hidden="true"></span>
              </button>
              <button type="button" class="table-btn dislike-btn" data-btn-on="{{ userComboData.dislike }}" aria-label="Dislike">
                <span class="glyphicon glyphicon-thumbs-down table-icon" aria-hidden="true"></span>
              </button>
            </td>
            <td>
              <button type="button" class="table-btn favorite-btn" data-btn-on="{{ userComboData.favorite }}" aria-label="Star">
                <span class="glyphicon glyphicon-star table-icon" aria-hidden="true"></span>
              </button>
            </td>
            <td>{{ userComboData.note }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
<div class="table-responsive">
  <table class="table table-striped table-hover" data-toggle="table" data-search="true" data-show-columns="true"> <!-- .table-condensed ?-->
    <thead>
      <tr>
          <th data-field="ingredients" data-sortable="true" data-sort-name="_ingredients_data" data-sorter="numIngsSorter">Ingredients</th>
          <th data-field="ratings" data-sortable="true">Ratings</th>
          <th data-field="pctliked" data-sortable="true">% Liked</th>
      </tr>
    </thead>
    <tbody>
      {% for ings, combo in data_row %}
        <tr>
          <td data-numings='{{ ings.count }}'>
            {% for ing in ings %}
              {{ ing }}
            {% endfor %}
          </td>
          <td>{{combo.get_num_tried}}</td>
          <td>{{combo.calc_percent_likes}}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
</div>
{% endblock content %}

{% block footer_js %}
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
  <script src="{% static 'js/vendor/bootstrap-table-editable.min.js' %}"></script>
{% endblock %}
